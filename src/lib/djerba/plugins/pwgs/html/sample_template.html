<%
  from djerba.plugins.pwgs.analysis.render.json_to_html import html_builder
  import djerba.plugins.pwgs.constants as constants
  from time import strftime
%>
<% date = strftime('%Y/%m/%d') %>

${html_builder().section_cells_begin("<h2>Patient & Physician</h2>","main")}
      
  <table class="info">
  <tr>  <th style="width:20%"></th>   <th style="width:12%"></th>  <th style="width:21%"></th>   <th style="width:30%"></th>  </tr>
  <tr>  <td colspan="1">Patient Name:</td> <td colspan="3">LAST NAME, FIRST NAME</td>  </tr>

    <tr>
      <td>Patient Genetic Sex:</td><td>SEX</td>
      <td>Patient DOB:</td><td>yyyy/mm/dd</td>
    </tr>
    <tr>
      <td >Physician Licence #:</td><td>nnnnnnnn</td>
      <td >Physician:</td><td>LAST, FIRST</td>
    </tr>
    <tr>
      <td>Physician Phone #:</td><td>nnn-nnn-nnnn</td>
      <td>Physician Hospital:</td><td>HOSPITAL NAME AND ADDRESS</td>
    </tr>
    <tr>
      <td>Requisition Approved:</td><td>${results.get(constants.REQ_APPROVED)}</td>
      <td>Requisitioner Email:</td><td><a href="mailto:NAME@DOMAIN.COM" class="email">NAME@DOMAIN.COM</a></td>
    </tr>
  </table>
      
${html_builder().section_cells_end()}

${html_builder().section_cells_begin("<h2>Case Overview</h2>","main")}

  <table class="info">
  <tr> <th style="width:20%"></th>  <th style="width:20%"></th>  <th style="width:20%"></th>  <th style="width:40%"></th> </tr>
  <tr> <td colspan="1">Assay:</td>  <td colspan="3"> ${results.get(constants.ASSAY)} </td> </tr>    

    <tr>
      <td>Site of biopsy:</td>  <td>Liquid Biopsy</td>
      <td>Primary cancer:</td> <td>${results.get(constants.PRIMARY_CANCER)}</td>
    </tr>
    <tr>
      <td>Type of Specimen:</td> <td>Plasma</td>
      <td>Date of Report:</td> <td>${date}</td>
    </tr>
    <tr>
      <td>Patient LIMS ID:</td><td>${results.get(constants.DONOR)}</td>
      <td>WGS Report ID:</td><td>${results.get(constants.WGS_REPORT)}</td>
    </tr>
    <tr>
      <td>Patient Study ID:</td><td>${results.get(constants.PATIENT_ID)}</td>
      <td>Plasma Sample ID:</td><td>${results.get(constants.GROUP_ID)}</td>
    </tr>
    <tr>
      <td>Study:</td><td>${results.get(constants.STUDY)}</td>
      <td>pWGS Report ID:</td><td>${results.get(constants.PWGS_REPORT)}</td>
    </tr>


  </table>

${html_builder().section_cells_end()}


<hr class="big-white-line" >
<div class="twocellmain" style="height: 80px;"  >
    <div class="oneoftwocellmain"  >
        <h2 >Summary</h2>
    </div>
    <div class="twooftwocellmain"  style="height: 80px; padding: 10px; background-color:rgba(101,188,69,.5);  border: 3px solid #65bc45; border-radius: 12px" >
        <hr class="big-line" style="margin-top: -30px;">

<h3 style="margin-top: 45px;">Minimal Residual Disease: ${results.get(constants.CTDNA_DETECTION)}</h3>
<table class="info" >
<tr>
  <td>Mutational sampling analysis:</td>
  <td>ctDNA ${results.get(constants.CTDNA_OUTCOME)}

  </td>
</tr>
</table>


${html_builder().section_cells_end()}


${html_builder().section_cells_begin("<h2>SAMPLE QC</h2>","main")}

  <table class="info">
    <tr>
      <th style="width:30%"></th>
      <th style="width:10%"></th>
      <th style="width:30%"></th>
      <th style="width:10%"></th>
      <th style="width:30%"></th>
      <th style="width:15%"></th>
    </tr>
    <tr>
      <td>Median Insert Size (bp):</td>
      % if results.get(constants.INSERT_SIZE) > 180:
      <td style="background-color:#ff0000;">${results.get(constants.INSERT_SIZE)}</td>
      % else:
      <td >${results.get(constants.INSERT_SIZE)}</td>
      % endif
      <td >Coverage (mean):</td>
      % if results.get(constants.COVERAGE) < 30:
      <td style="background-color:#ff0000;">${results.get(constants.COVERAGE)}</td>
      % else:
      <td >${results.get(constants.COVERAGE)}</td>
      % endif 
      <td >Primary SNVs:</td>
      % if results.get(constants.SNV_COUNT) < 4000:
      <td style="background-color:#ff0000;">${html_builder().k_comma_format(results.get(constants.SNV_COUNT))}</td>
      % else:
      <td >${html_builder().k_comma_format(results.get(constants.SNV_COUNT))}</td>
      % endif 
    </tr>
  </table>

${html_builder().section_cells_end()}
